# name: Build ZMK firmware
# on: [push, pull_request, workflow_dispatch]

# jobs:
#   build:
#     uses: zmkfirmware/zmk/.github/workflows/build-user-config.yml@main


name: Build ZMK firmware
on: [push, pull_request, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. è‡ªèº«ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¨­å®šãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      #    ZMK_CONFIG ã«åˆ©ç”¨ã™ã‚‹ãŸã‚ 'config' ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¾ã™ã€‚
      - name: Checkout Config
        uses: actions/checkout@v4
        with:
          path: config

      # 2. ğŸ’¡ å¿…è¦ãªå¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (zmk-input-gestures) ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      #    ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã—ã¾ã™ã€‚
      - name: Checkout ZMK Input Gestures Module
        uses: actions/checkout@v4
        with:
          repository: halfdane/zmk-input-gestures
          path: zmk-input-gestures 

      # 3. ZMK ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
      #    å·¦å³ä¸¡æ–¹ã®ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã‚’ãƒ“ãƒ«ãƒ‰ã—ã€è¿½åŠ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‘ã‚¹ã‚’æ­£ã—ãæ¸¡ã—ã¾ã™ã€‚
      - name: Build ZMK Firmware (Left/Right)
        uses: zmkfirmware/zmk-build-action@v2
        with:
          # config (ã‚ãªãŸã®ãƒªãƒã‚¸ãƒˆãƒª) ã¨ zmk-input-gestures ã®ä¸¡æ–¹ã®ãƒ‘ã‚¹ã‚’æ¸¡ã—ã¾ã™
          extra_modules: 'config;zmk-input-gestures' 
          
          # å…ƒã®ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰è¨­å®šã‚’é©ç”¨
          build_args: >
            -DSHIELD="split_ortho4x6_right split_ortho4x6_left" 
            -DCONFIG_ZMK_STUDIO=y
            
          archive_name: firmware-split-ortho4x6

      # 4. ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã‚’æˆæœç‰©ã¨ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: firmware-split-ortho4x6
          path: firmware-split-ortho4x6.zip
          retention-days: 7